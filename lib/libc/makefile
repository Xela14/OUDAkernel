# Contains all variable definitions
include config.mk

LIBRARIES    := libk.a

# Add all the .c files in the library directory recursively as .o files
LIBK_OBJECTS := $(patsubst %.c,%.o,$(shell find . -name "*.c"))

.PHONY: all clean

all: $(LIBRARIES)

libk.a: $(LIBK_OBJECTS)
	$(AR) rcsv $@ $(LIBK_OBJECTS)

$(LIBK_OBJECTS): %.o: %.c
	$(CC) -MD -c $< -o $@  $(CFLAGS)

# Eventually will add a rule for assembly .s/.S files

clean:
	rm -f $(BINARIES) *.a
	rm -f $(OBJS) $(LIBK_OBJS) *.o */*.o */*/*.o
	rm -f $(OBJS:.o=.d) $(LIBK_OBJS:.o=.d) *.d */*.d */*/*.d

# Include rules to make this makefile depend on changes in header files as well generated by -MD
-include $(LIBK_OBJECTS:.o=.d)

